#!/bin/bash
# Project Launcher - Quick access to Claude projects
# Usage: launch [project-id] or just `launch` to list all

PROJECTS_DIR="/Users/z/Desktop/PersonalProjects/ClaudeProjects"
PROJECTS_JSON="$PROJECTS_DIR/projects.json"

# Colors
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

# Project definitions with launch commands
declare -A PROJECTS
PROJECTS=(
    ["voice"]="start_voice_app"
    ["voice-memo"]="start_voice_app"
    ["voice-memo-transcriber"]="start_voice_app"
    ["voice-dashboard"]="open '$PROJECTS_DIR/voice-memo-transcriber/dashboard/index.html'"

    ["study"]="open '$PROJECTS_DIR/notebooklm_scrape/study-app/index.html'"
    ["notebooklm"]="open '$PROJECTS_DIR/notebooklm_scrape/study-app/index.html'"
    ["study-app"]="open '$PROJECTS_DIR/notebooklm_scrape/study-app/index.html'"

    ["substack"]="open '$PROJECTS_DIR/substack-dashboard/index.html'"
    ["substack-dashboard"]="open '$PROJECTS_DIR/substack-dashboard/index.html'"

    ["art"]="open '$PROJECTS_DIR/art-discovery/index.html'"
    ["art-discovery"]="open '$PROJECTS_DIR/art-discovery/index.html'"

    ["htgaa"]="open '$PROJECTS_DIR/htgaa-biobootcamp/htgaa-day1-course.html'"
    ["biobootcamp"]="open '$PROJECTS_DIR/htgaa-biobootcamp/htgaa-day1-course.html'"

    ["command"]="open '$PROJECTS_DIR/project-command-center/index.html'"
    ["projects"]="open '$PROJECTS_DIR/project-command-center/index.html'"
    ["command-center"]="open '$PROJECTS_DIR/project-command-center/index.html'"

    ["reading"]="open '$PROJECTS_DIR/reading-dashboard/index.html'"
    ["reading-dashboard"]="open '$PROJECTS_DIR/reading-dashboard/index.html'"
)

# Hosted URLs for quick access
declare -A HOSTED
HOSTED=(
    ["study-hosted"]="open 'https://elaborate-beignet-acdd88.netlify.app/'"
    ["art-hosted"]="open 'https://art-discoverer.netlify.app'"
    ["htgaa-hosted"]="open 'https://anonyma.github.io/htgaa-biobootcamp/htgaa-day1-course.html'"
    ["command-hosted"]="open 'https://project-command-center.netlify.app'"
)

# Function to start voice memo transcriber (server + dashboard)
start_voice_app() {
    echo -e "${GREEN}Starting Voice Memo Transcriber...${NC}"

    # Check if server is already running
    if curl -s http://localhost:5111/health > /dev/null 2>&1; then
        echo -e "${BLUE}Server already running${NC}"
    else
        echo -e "${YELLOW}Starting transcription server...${NC}"
        cd "$PROJECTS_DIR/voice-memo-transcriber"
        python3 server.py &
        SERVER_PID=$!
        sleep 2

        if curl -s http://localhost:5111/health > /dev/null 2>&1; then
            echo -e "${GREEN}Server started (PID: $SERVER_PID)${NC}"
        else
            echo -e "${YELLOW}Server may take a moment to start...${NC}"
        fi
    fi

    echo -e "${GREEN}Opening dashboard...${NC}"
    open "$PROJECTS_DIR/voice-memo-transcriber/dashboard/index.html"
}

# Function to stop voice server
stop_voice_server() {
    if pkill -f "python3 server.py"; then
        echo -e "${GREEN}Voice server stopped${NC}"
    else
        echo -e "${YELLOW}No voice server running${NC}"
    fi
}

show_help() {
    echo -e "${CYAN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${CYAN}â•‘${NC}              ${GREEN}Claude Projects Launcher${NC}                      ${CYAN}â•‘${NC}"
    echo -e "${CYAN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    echo -e "${YELLOW}Usage:${NC} launch [project-name]"
    echo ""
    echo -e "${GREEN}Local Dashboards:${NC}"
    echo -e "  ${BLUE}voice${NC}, voice-memo        Voice Memo Transcriber (starts server + dashboard)"
    echo -e "  ${BLUE}study${NC}, notebooklm        NotebookLM Study App"
    echo -e "  ${BLUE}substack${NC}                 Substack Reading Dashboard"
    echo -e "  ${BLUE}art${NC}                      Art Discovery App"
    echo -e "  ${BLUE}htgaa${NC}, biobootcamp       HTGAA BioBootcamp Study Guide"
    echo -e "  ${BLUE}command${NC}, projects        Project Command Center"
    echo -e "  ${BLUE}reading${NC}                  NotebookLM Reading Dashboard"
    echo ""
    echo -e "${GREEN}Hosted Versions:${NC} (add -hosted suffix)"
    echo -e "  ${BLUE}study-hosted${NC}             NotebookLM Study App (Netlify)"
    echo -e "  ${BLUE}art-hosted${NC}               Art Discovery (Netlify)"
    echo -e "  ${BLUE}htgaa-hosted${NC}             HTGAA (GitHub Pages)"
    echo -e "  ${BLUE}command-hosted${NC}           Project Command Center (Netlify)"
    echo ""
    echo -e "${GREEN}Special Commands:${NC}"
    echo -e "  ${BLUE}launch list${NC}              Show all projects from projects.json"
    echo -e "  ${BLUE}launch edit${NC}              Open projects.json in editor"
    echo -e "  ${BLUE}launch dir${NC}               Open ClaudeProjects folder"
    echo -e "  ${BLUE}launch voice-stop${NC}        Stop the voice transcriber server"
    echo ""
}

list_projects() {
    echo -e "${CYAN}Projects from projects.json:${NC}"
    echo ""
    # Use Python to parse JSON since it's more reliable than jq on mac
    python3 << 'PYTHON'
import json
with open('/Users/z/Desktop/PersonalProjects/ClaudeProjects/projects.json') as f:
    data = json.load(f)
    for p in data['projects']:
        status_icon = {'active': 'âœ…', 'wip': 'ğŸš§', 'needs-fix': 'âš ï¸', 'deprecated': 'ğŸ“¦'}.get(p.get('status', 'active'), 'â“')
        print(f"  {status_icon} {p['id']:<25} {p['name']}")
PYTHON
    echo ""
}

# Handle arguments
case "$1" in
    ""|"-h"|"--help"|"help")
        show_help
        ;;
    "list"|"ls")
        list_projects
        ;;
    "edit")
        ${EDITOR:-code} "$PROJECTS_JSON"
        ;;
    "dir"|"folder"|"open")
        open "$PROJECTS_DIR"
        ;;
    "voice-stop"|"stop-voice")
        stop_voice_server
        ;;
    *)
        # Check local projects first
        if [[ -v "PROJECTS[$1]" ]]; then
            echo -e "${GREEN}Opening $1...${NC}"
            eval "${PROJECTS[$1]}"
        # Check hosted versions
        elif [[ -v "HOSTED[$1]" ]]; then
            echo -e "${GREEN}Opening $1 (hosted)...${NC}"
            eval "${HOSTED[$1]}"
        else
            echo -e "${YELLOW}Unknown project: $1${NC}"
            echo ""
            show_help
            exit 1
        fi
        ;;
esac
